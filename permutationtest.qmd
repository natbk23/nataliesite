---
title: "Permutation Test on Movie Box Office"
author: "Natalie Roston"
format: html
---

**Introduction**

In this analysis, I wanted to test whether there is a significant difference in the average box office revenue between action and comedy movies using the \`movies\` dataset from OpenIntro. I use a permutation test to evaluate if any observed difference in average box office gross is statistically significant under the null hypothesis that genre does not affect revenue. I hypothesize that action movies have a higher box office revenue than comedies.

**Data Setup**

```{r}
library(openintro)
library(ggplot2)
library(purrr)

data("movies")

str(movies)
```

```{r}
movies$box_office <- as.numeric(movies$box_office)  
movies <- na.omit(movies)  

# Calculate the observed difference in mean box office revenue between action and comedy movies
observed_diff <- with(movies, 
                      mean(box_office[genre == "action"], na.rm = TRUE) - 
                      mean(box_office[genre == "comedy"], na.rm = TRUE))

observed_diff

```

```{r}
permute_diff <- function(data) {
  shuffled_genre <- sample(data$genre)
  mean(data$box_office[shuffled_genre == "action"], na.rm = TRUE) - 
    mean(data$box_office[shuffled_genre == "comedy"], na.rm = TRUE)
}

```

```{r}
set.seed(123) 
num_simulations <- 10000
perm_diffs <- map_dbl(1:num_simulations, ~ permute_diff(movies))

```

```{r}
perm_data <- data.frame(perm_diffs = perm_diffs)

ggplot(perm_data, aes(x = perm_diffs)) +
  geom_histogram(binwidth = 50000000, color = "black", fill = "skyblue", alpha = 0.7) +
  geom_vline(xintercept = observed_diff, color = "red", linetype = "dashed", size = 1) +
  labs(
    title = "Permutation Test: Box Office Gross Differences Between Action and Comedy Movies",
    x = "Difference in Mean Gross (Action - Comedy)",
    y = "Frequency"
  ) +
  theme_minimal()

```

This plot illustrates the results of a permutation test designed to assess whether there is a statistically significant difference in box office revenue between action and comedy movies. In the histogram, we see the distribution of mean differences in box office revenue under the null hypothesis, which assumes there is no true effect of genre on box office performance. Each bar represents the frequency of mean differences obtained by randomly shuffling genre labels (action and comedy) across all movies, then calculating the difference in means for each shuffle. This simulated distribution of differences reveals the range of values we might expect if genre had no impact on revenue.

The red dashed line in the plot marks the observed difference in box office revenue between action and comedy movies as calculated from the original data set. This observed difference provides the basis for testing our hypothesis. If this red line lies well outside the central bulk of the histogram, it indicates that the observed difference is unusual compared to what we would expect under the null hypothesis. In other words, a position far from the central peak of the histogram suggests that the observed difference in revenue is not easily explainable by random variation alone.

```{r}
p_value <- mean(abs(perm_diffs) >= abs(observed_diff))
p_value

```

The position of the observed difference near the tail of the distribution aligns with a p-value of 0.0406, indicating a statistically significant result at the 5% significance level. This means that, under the null hypothesis, there is only a 4.06% chance of observing a difference as extreme as the one in our data set. Consequently, the plot supports the conclusion that there is likely a true difference in box office revenue between action and comedy movies, with genre possibly influencing financial performance. This visualization, therefore, provides both a statistical and a visual basis for concluding that genre may have an impact on box office success.

Source:

OpenIntro Package, [Investigating Statistical Concepts, Applications and Methods](http://www.rossmanchance.com/iscam2/data/movies03.txt)
